<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smile Moore - Email Template Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(to right, #1f3a33, #70d490);
            color: white;
            padding: 30px;
            border-radius: 8px 8px 0 0;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .nav {
            display: flex;
            background: #1f3a33;
            overflow-x: auto;
        }

        .nav button {
            background: transparent;
            border: none;
            color: white;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 14px;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .nav button:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav button.active {
            border-bottom-color: #70d490;
            background: rgba(112, 212, 144, 0.1);
        }

        .content {
            padding: 30px;
        }

        .email-card {
            display: none;
        }

        .email-card.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .editor-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 1024px) {
            .editor-layout {
                grid-template-columns: 1fr;
            }
        }

        .editor-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .editor-panel h3 {
            color: #1f3a33;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .preview-panel {
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-controls {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .preview-controls button {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .preview-controls button.active {
            background: #1f3a33;
            color: white;
            border-color: #1f3a33;
        }

        .preview-controls button:hover:not(.active) {
            border-color: #1f3a33;
        }

        .preview-viewport {
            padding: 20px;
            min-height: 500px;
            background: white;
            transition: all 0.3s;
        }

        .preview-viewport.mobile {
            width: 390px;
            height: 844px;
            max-width: 390px;
            margin: 0 auto;
            background: #000;
            border: 12px solid #000;
            border-radius: 40px;
            box-shadow: 0 0 0 2px #1d1d1f, 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
        }

        .preview-viewport.mobile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 30px;
            background: #000;
            border-radius: 0 0 20px 20px;
            z-index: 10;
        }

        .preview-viewport.mobile .email-preview {
            height: 100%;
            overflow-y: auto;
        }

        .preview-viewport.desktop {
            max-width: 100%;
        }

        .email-preview {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .email-header {
            background: linear-gradient(to right, #1f3a33, #70d490);
            padding: 30px;
            text-align: center;
        }

        .email-header h2 {
            color: white;
            font-size: 28px;
        }

        .email-body {
            padding: 30px;
        }

        .email-body h3 {
            color: #1f3a33;
            margin-bottom: 15px;
        }

        .email-body p {
            color: #333;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .voucher-code {
            background: #cfe8d7;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }

        .voucher-code-text {
            font-size: 32px;
            font-weight: bold;
            color: #1f3a33;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }

        .prize-box {
            background: #cfe8d7;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }

        .prize-box h4 {
            color: #1f3a33;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #1f3a33;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input[type="text"]:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #70d490;
        }

        .form-group textarea {
            min-height: 250px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #1f3a33;
            color: white;
        }

        .btn-primary:hover {
            background: #2d5449;
            transform: translateY(-1px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert.show {
            display: flex;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #70d490;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box h3 {
            color: #1f3a33;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-box p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .code-location {
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
        }

        .code-location strong {
            color: #61afef;
        }

        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .tag-trigger {
            background: #e3f2fd;
            color: #1976d2;
        }

        .tag-timing {
            background: #fff3e0;
            color: #f57c00;
        }

        .tag-entries {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .family-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .family-table th {
            background: #1f3a33;
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 14px;
        }

        .family-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }

        .family-table tr:last-child td {
            border-bottom: none;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1f3a33, #2d5449);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 13px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Multi-Channel Communication Manager</h1>
            <p>Edit, preview, and deploy across Email, WhatsApp, SMS & Website</p>
        </div>

        <div class="nav">
            <button class="active" onclick="showMainSection('overview')">üìä Overview</button>
            <button onclick="showMainSection('email')">üìß Email</button>
            <button onclick="showMainSection('whatsapp')">üí¨ WhatsApp</button>
            <button onclick="showMainSection('sms')">üì± SMS</button>
            <button onclick="showMainSection('funnel')">üéØ Funnel</button>
        </div>

        <!-- Email Sub-Navigation -->
        <div id="email-subnav" class="nav" style="background: #f8f9fa; display: none; border-top: 2px solid #e0e0e0;">
            <button class="active" onclick="showTab('email-overview')">üìß Overview</button>
            <button onclick="showTab('voucher-single')">‚úâÔ∏è Voucher Single</button>
            <button onclick="showTab('voucher-family')">üë®‚Äçüë©‚Äçüëß Voucher Family</button>
            <button onclick="showTab('4q-1')">üì¨ 4Q Follow-up #1</button>
            <button onclick="showTab('4q-2')">üì¨ 4Q Follow-up #2</button>
            <button onclick="showTab('4q-3')">üì¨ 4Q Follow-up #3</button>
            <button onclick="showTab('10q-1')">üìÆ 10Q Follow-up #1</button>
            <button onclick="showTab('10q-2')">üìÆ 10Q Follow-up #2</button>
            <button onclick="showTab('10q-3')">üìÆ 10Q Follow-up #3</button>
            <button onclick="showTab('christmas')">üéÑ Christmas</button>
            <button onclick="showTab('referral')">üîó Referral</button>
        </div>

        <div class="content">
            <div id="alert" class="alert"></div>

            <!-- OVERVIEW TAB - ANALYTICS DASHBOARD -->
            <div id="overview" class="email-card active">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">üìä Marketing Analytics Dashboard</h2>

                <div class="info-box" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left: 4px solid #4caf50;">
                    <h3>‚úÖ Campaign Tracking Status: ACTIVE</h3>
                    <p><strong>All email and SMS templates are configured with tracking parameters.</strong></p>
                    <p>Campaign Source tracking in Visitors sheet (Column D) captures:</p>
                    <ul style="margin: 10px 0 10px 20px; line-height: 1.8;">
                        <li><strong>Email Templates:</strong> Email: 4Q Follow-up #1, #2, #3 | 10Q Follow-up #1, #2, #3 | Voucher Single/Family | Christmas | Referral</li>
                        <li><strong>SMS Templates:</strong> SMS: 4Q Follow-up #1 | 10Q Follow-up #1 | Referral</li>
                        <li><strong>Referral Links:</strong> Referral: [Name]-[Code]</li>
                        <li><strong>Direct Traffic:</strong> URL Direct | QR</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>‚úÖ Google Sheets Integration:</strong> All data auto-syncs to Home tab (signups) and Visitors tab (traffic)</p>
                    <p><strong>‚úÖ Entry System:</strong> +1 entry (basic info) | +1 entry (5 questions) | +1 entry (10 questions) | +10 entries (per referral)</p>
                </div>

                <div class="info-box">
                    <h3>üìà Track Performance Across All Channels</h3>
                    <p>Monitor open rates, click-through rates, conversions, and engagement metrics for Email, WhatsApp, SMS, and Funnel pages.</p>
                </div>

                <!-- Channel Performance Overview -->
                <h3 style="color: #1f3a33; margin: 30px 0 15px;">üìß Email Performance</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="number" id="email-sent-count">0</div>
                        <div class="label">Emails Sent</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="email-open-rate">0%</div>
                        <div class="label">Open Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="email-click-rate">0%</div>
                        <div class="label">Click Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="email-conversion-rate">0%</div>
                        <div class="label">Conversion Rate</div>
                    </div>
                </div>

                <!-- Email Template Breakdown -->
                <h3 style="color: #1f3a33; margin: 30px 0 15px;">üì¨ Email Template Performance</h3>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #1f3a33; color: white;">
                                <th style="padding: 12px; text-align: left;">Template</th>
                                <th style="padding: 12px; text-align: center;">Sent</th>
                                <th style="padding: 12px; text-align: center;">Opened</th>
                                <th style="padding: 12px; text-align: center;">Clicked</th>
                                <th style="padding: 12px; text-align: center;">Open %</th>
                                <th style="padding: 12px; text-align: center;">Click %</th>
                            </tr>
                        </thead>
                        <tbody id="email-template-stats">
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px;">‚úâÔ∏è Voucher (Single)</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px;">üë®‚Äçüë©‚Äçüëß Voucher (Family)</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px;">üì¨ 4Q Follow-up #1</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px;">üì¨ 4Q Follow-up #2</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px;">üì¨ 4Q Follow-up #3</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                                <td style="padding: 12px; text-align: center;">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- WhatsApp Performance -->
                <h3 style="color: #1f3a33; margin: 30px 0 15px;">üí¨ WhatsApp Performance</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="number" id="whatsapp-sent-count">0</div>
                        <div class="label">Messages Sent</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="whatsapp-read-rate">0%</div>
                        <div class="label">Read Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="whatsapp-reply-rate">0%</div>
                        <div class="label">Reply Rate</div>
                    </div>
                </div>

                <!-- SMS Performance -->
                <h3 style="color: #1f3a33; margin: 30px 0 15px;">üì± SMS Performance</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="number" id="sms-sent-count">0</div>
                        <div class="label">SMS Sent</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="sms-delivery-rate">0%</div>
                        <div class="label">Delivery Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="sms-click-rate">0%</div>
                        <div class="label">Click Rate</div>
                    </div>
                </div>

                <!-- Funnel Performance -->
                <h3 style="color: #1f3a33; margin: 30px 0 15px;">üéØ Funnel Performance</h3>
                <div class="stats">
                    <div class="stat-card">
                        <div class="number" id="funnel-visitors">0</div>
                        <div class="label">Total Visitors</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="funnel-form-starts">0</div>
                        <div class="label">Form Starts</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="funnel-completions">0</div>
                        <div class="label">Completions</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="funnel-conversion-rate">0%</div>
                        <div class="label">Conversion Rate</div>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <h3>üîÑ Data Refresh</h3>
                    <p>Analytics data updates every 5 minutes. Last updated: <span id="last-updated">Loading...</span></p>
                    <button class="btn btn-primary" onclick="refreshAnalytics()" style="margin-top: 10px;">
                        üîÑ Refresh Now
                    </button>
                </div>
            </div>

            <!-- EMAIL OVERVIEW (shown when Email tab is selected) -->
            <div id="email-overview" class="email-card" style="display: none;">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">üìß Email Templates System</h2>

                <div class="stats" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="number">11</div>
                        <div class="label">Email Templates</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">2</div>
                        <div class="label">Voucher Types</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">8</div>
                        <div class="label">Follow-up Sequences</div>
                    </div>
                </div>

                <div class="info-box">
                    <h3>‚úèÔ∏è How to Edit Email Templates</h3>
                    <p><strong>Step 1:</strong> Click on any template button in the sub-menu above (e.g., "Voucher Single", "4Q Follow-up #1")<br>
                    <strong>Step 2:</strong> In the left panel, edit the subject line and email body text<br>
                    <strong>Step 3:</strong> Watch the preview update in real-time on the right (switch between Mobile üì± and Desktop üíª views)<br>
                    <strong>Step 4:</strong> Click "üíæ Save & Deploy" button to push changes live<br>
                    <strong>Step 5:</strong> Changes go live immediately - all future emails will use your new content!</p>
                </div>

                <div class="info-box" style="background: #e8f5e9; border-left-color: #70d490;">
                    <h3>üéØ Smart Email Deduplication</h3>
                    <p><strong>Family-Friendly System:</strong> When parents sign up multiple family members using the same email address, our system intelligently sends <strong>only ONE consolidated email</strong> with all voucher codes in a neat table. This prevents inbox spam and keeps families happy!</p>
                    <p><strong>Example:</strong> Dad signs up himself + 3 kids with same email ‚Üí Receives 1 email with 4 voucher codes neatly organized.</p>
                </div>

                <h3 style="color: #1f3a33; margin: 30px 0 15px;">üì® Automated Email Flow</h3>
                <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #70d490;">
                    <div style="font-family: monospace; font-size: 13px; line-height: 2;">
<strong>Stage 1: Voucher Claimed</strong>
‚Üí ‚úâÔ∏è <strong>Voucher Confirmation</strong> (instant)
   ‚Ä¢ Single email for individual signups
   ‚Ä¢ Family email for multiple signups with same email

<strong>Stage 2: First Entry (1/4 questions answered)</strong>
‚Üí üì¨ <strong>4Q Follow-up #1</strong> (instant)
   ‚îú‚îÄ Email opened ‚úì ‚Üí Stop sending
   ‚îî‚îÄ Email NOT opened ‚úó
      ‚Üì Wait 48 hours
      ‚Üí üì¨ <strong>4Q Follow-up #2</strong>
         ‚îú‚îÄ Email opened ‚úì ‚Üí Stop sending
         ‚îî‚îÄ Email NOT opened ‚úó
            ‚Üì Wait 48 hours
            ‚Üí üì¨ <strong>4Q Follow-up #3</strong> (final reminder)

<strong>Stage 3: Second Entry (2/4 questions answered)</strong>
‚Üí üìÆ <strong>10Q Follow-up #1</strong> (instant)
   ‚îú‚îÄ Email opened ‚úì ‚Üí Stop sending
   ‚îî‚îÄ Email NOT opened ‚úó
      ‚Üì Wait 48 hours
      ‚Üí üìÆ <strong>10Q Follow-up #2</strong>
         ‚îú‚îÄ Email opened ‚úì ‚Üí Stop sending
         ‚îî‚îÄ Email NOT opened ‚úó
            ‚Üì Wait 48 hours
            ‚Üí üìÆ <strong>10Q Follow-up #3</strong> (final reminder)

<strong>Stage 4: Third Entry (3/4 questions answered)</strong>
‚Üí üéÑ <strong>Christmas Sharing Email</strong> (instant)
   ‚Ä¢ Encourages referral sharing during festive season

<strong>Referral Campaign (Manual/Scheduled)</strong>
‚Üí üîó <strong>Referral Follow-up</strong>
   ‚Ä¢ Reminds users to share their unique link
   ‚Ä¢ Highlights +10 entries per referral benefit
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px; background: #fff3e0; border-left-color: #f57c00;">
                    <h3>‚ö° Important Notes</h3>
                    <p>‚Ä¢ All templates support personalization with [Name], [Code], [ENTRIES] placeholders<br>
                    ‚Ä¢ Email tracking (opens/clicks) is automatic via Resend webhooks<br>
                    ‚Ä¢ Follow-up sequences stop automatically when user opens any email<br>
                    ‚Ä¢ Maximum 3 attempts per follow-up sequence (prevents spam)<br>
                    ‚Ä¢ 48-hour gap between follow-up attempts</p>
                </div>
            </div>

            <!-- 4Q FOLLOW-UP #1 TAB -->
            <div id="4q-1" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">4-Question Follow-up #1</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: 1 entry</span>
                    <span class="tag tag-timing">Send: Immediate</span>
                    <span class="tag tag-entries">Goal: 2 entries</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="4q-1-subject"
                                   value="üéÅ Quick reminder: Boost your prize draw entries!"
                                   oninput="updatePreview('4q-1')">
                        </div>

                        <div class="form-group">
                            <label>Email Body</label>
                            <textarea id="4q-1-body" oninput="updatePreview('4q-1')">Hi [Name],

We noticed you claimed your ¬£50 voucher but haven't entered the prize draw yet!

It only takes 1 minute to answer 4 quick questions and you'll receive +1 bonus entry.

Click here to complete: https://smilemoore.co.uk?email=4q-1

Thank you!
Smile Moore Team</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('4q', 0)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('4q-1')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/send-follow-ups/route.ts<br>
                            <strong>Lines:</strong> 27-42<br>
                            <strong>Array:</strong> fourQuestionVariations[0]
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('4q-1', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('4q-1', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="4q-1-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div style="padding: 20px; background: #f5f5f5;">
                                    <div style="background: white; padding: 30px; border-radius: 8px;">
                                        <div id="4q-1-preview-subject" style="font-weight: bold; font-size: 18px; margin-bottom: 20px; color: #1f3a33;">
                                            üéÅ Quick reminder: Boost your prize draw entries!
                                        </div>
                                        <div id="4q-1-preview-body" style="line-height: 1.6; white-space: pre-wrap; color: #333;">Hi John,

We noticed you claimed your ¬£50 voucher but haven't entered the prize draw yet!

It only takes 1 minute to answer 4 quick questions and you'll receive +1 bonus entry.

Click here to complete: https://smilemoore.co.uk?email=4q-1

Thank you!
Smile Moore Team</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4Q FOLLOW-UP #2 TAB -->
            <div id="4q-2" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">4-Question Follow-up #2</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: #1 not opened</span>
                    <span class="tag tag-timing">Send: 48hrs after #1</span>
                    <span class="tag tag-entries">User has: 1 entry</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="4q-2-subject"
                                   value="Don't miss out on winning up to ¬£5,000 of free dentistry!"
                                   oninput="updatePreview('4q-2')">
                        </div>

                        <div class="form-group">
                            <label>Email Body</label>
                            <textarea id="4q-2-body" oninput="updatePreview('4q-2')">Hi [Name],

You're so close! Complete 4 simple questions to enter the draw for 1 Year of FREE Dentistry worth up to ¬£5,000.

Plus, you'll earn another entry bringing your total to 2 entries.

Complete now: https://smilemoore.co.uk?email=4q-2

Best regards,
Smile Moore Team</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('4q', 1)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('4q-2')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/send-follow-ups/route.ts<br>
                            <strong>Lines:</strong> 43-57<br>
                            <strong>Array:</strong> fourQuestionVariations[1]
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('4q-2', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('4q-2', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="4q-2-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div style="padding: 20px; background: #f5f5f5;">
                                    <div style="background: white; padding: 30px; border-radius: 8px;">
                                        <div id="4q-2-preview-subject" style="font-weight: bold; font-size: 18px; margin-bottom: 20px; color: #1f3a33;">
                                            Don't miss out on winning up to ¬£5,000 of free dentistry!
                                        </div>
                                        <div id="4q-2-preview-body" style="line-height: 1.6; white-space: pre-wrap; color: #333;">Hi John,

You're so close! Complete 4 simple questions to enter the draw for 1 Year of FREE Dentistry worth up to ¬£5,000.

Plus, you'll earn another entry bringing your total to 2 entries.

Complete now: https://smilemoore.co.uk?email=4q-2

Best regards,
Smile Moore Team</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4Q FOLLOW-UP #3 TAB -->
            <div id="4q-3" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">4-Question Follow-up #3 (Final)</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: #2 not opened</span>
                    <span class="tag tag-timing">Send: 48hrs after #2</span>
                    <span class="tag tag-entries">Final reminder</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="4q-3-subject"
                                   value="Final chance: Enter the prize draw"
                                   oninput="updatePreview('4q-3')">
                        </div>

                        <div class="form-group">
                            <label>Email Body</label>
                            <textarea id="4q-3-body" oninput="updatePreview('4q-3')">Hi [Name],

This is your last reminder to enter the prize draw worth up to ¬£5,000!

4 quick questions = +1 entry in the draw
Takes less than 60 seconds

Complete your entry: https://smilemoore.co.uk?email=4q-3

Thank you,
Smile Moore Team</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('4q', 2)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('4q-3')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/send-follow-ups/route.ts<br>
                            <strong>Lines:</strong> 58-73<br>
                            <strong>Array:</strong> fourQuestionVariations[2]
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('4q-3', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('4q-3', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="4q-3-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div style="padding: 20px; background: #f5f5f5;">
                                    <div style="background: white; padding: 30px; border-radius: 8px;">
                                        <div id="4q-3-preview-subject" style="font-weight: bold; font-size: 18px; margin-bottom: 20px; color: #1f3a33;">
                                            Final chance: Enter the prize draw
                                        </div>
                                        <div id="4q-3-preview-body" style="line-height: 1.6; white-space: pre-wrap; color: #333;">Hi John,

This is your last reminder to enter the prize draw worth up to ¬£5,000!

4 quick questions = +1 entry in the draw
Takes less than 60 seconds

Complete your entry: https://smilemoore.co.uk?email=4q-3

Thank you,
Smile Moore Team</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 10Q FOLLOW-UP #1 TAB -->
            <div id="10q-1" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">10-Question Follow-up #1</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: 2 entries</span>
                    <span class="tag tag-timing">Send: Immediate</span>
                    <span class="tag tag-entries">Goal: 3 entries</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="10q-1-subject"
                                   value="üåü One more step to maximize your prize entries!"
                                   oninput="updatePreview('10q-1')">
                        </div>

                        <div class="form-group">
                            <label>Email Body</label>
                            <textarea id="10q-1-body" oninput="updatePreview('10q-1')">Hi [Name],

Great job completing the first questions! You now have 2 entries in the prize draw worth up to ¬£5,000.

Want to increase your chances? Answer 10 more quick questions and earn +1 bonus entry (3 entries total).

Continue here: https://smilemoore.co.uk

Thank you!
Smile Moore Team</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('10q', 0)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('10q-1')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/send-follow-ups/route.ts<br>
                            <strong>Lines:</strong> 103-117<br>
                            <strong>Array:</strong> tenQuestionVariations[0]
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('10q-1', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('10q-1', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="10q-1-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div style="padding: 20px; background: #f5f5f5;">
                                    <div style="background: white; padding: 30px; border-radius: 8px;">
                                        <div id="10q-1-preview-subject" style="font-weight: bold; font-size: 18px; margin-bottom: 20px; color: #1f3a33;">
                                            üåü One more step to maximize your prize entries!
                                        </div>
                                        <div id="10q-1-preview-body" style="line-height: 1.6; white-space: pre-wrap; color: #333;">Hi John,

Great job completing the first questions! You now have 2 entries in the prize draw worth up to ¬£5,000.

Want to increase your chances? Answer 10 more quick questions and earn +1 bonus entry (3 entries total).

Continue here: https://smilemoore.co.uk?email=10q-1

Thank you!
Smile Moore Team</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 10Q FOLLOW-UP #2 TAB -->
            <div id="10q-2" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">10-Question Follow-up #2</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: #1 not opened</span>
                    <span class="tag tag-timing">Send: 48hrs after #1</span>
                    <span class="tag tag-entries">User has: 2 entries</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="10q-2-subject"
                                   value="Help us build your perfect dental practice"
                                   oninput="updatePreview('10q-2')">
                        </div>

                        <div class="form-group">
                            <label>Email Body</label>
                            <textarea id="10q-2-body" oninput="updatePreview('10q-2')">Hi [Name],

Your feedback is incredibly valuable! We'd love to hear more about your dental preferences.

Complete 10 additional questions and you'll receive:
‚Ä¢ +1 bonus entry in the prize draw (3 total)
‚Ä¢ Help shape your perfect dental experience

Share your thoughts: https://smilemoore.co.uk

Best regards,
Smile Moore Team</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('10q', 1)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('10q-2')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/send-follow-ups/route.ts<br>
                            <strong>Lines:</strong> 118-134<br>
                            <strong>Array:</strong> tenQuestionVariations[1]
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('10q-2', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('10q-2', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="10q-2-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div style="padding: 20px; background: #f5f5f5;">
                                    <div style="background: white; padding: 30px; border-radius: 8px;">
                                        <div id="10q-2-preview-subject" style="font-weight: bold; font-size: 18px; margin-bottom: 20px; color: #1f3a33;">
                                            Help us build your perfect dental practice
                                        </div>
                                        <div id="10q-2-preview-body" style="line-height: 1.6; white-space: pre-wrap; color: #333;">Hi John,

Your feedback is incredibly valuable! We'd love to hear more about your dental preferences.

Complete 10 additional questions and you'll receive:
‚Ä¢ +1 bonus entry in the prize draw (3 total)
‚Ä¢ Help shape your perfect dental experience

Share your thoughts: https://smilemoore.co.uk?email=10q-2

Best regards,
Smile Moore Team</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 10Q FOLLOW-UP #3 TAB -->
            <div id="10q-3" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">10-Question Follow-up #3 (Final)</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: #2 not opened</span>
                    <span class="tag tag-timing">Send: 48hrs after #2</span>
                    <span class="tag tag-entries">Final reminder</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="10q-3-subject"
                                   value="Last call: Get your 3rd prize draw entry"
                                   oninput="updatePreview('10q-3')">
                        </div>

                        <div class="form-group">
                            <label>Email Body</label>
                            <textarea id="10q-3-body" oninput="updatePreview('10q-3')">Hi [Name],

This is your final reminder to maximize your prize draw entries!

You currently have 2 entries. Complete the extended survey to earn your 3rd entry.

It takes just 2 minutes: https://smilemoore.co.uk

Thank you,
Smile Moore Team</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('10q', 2)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('10q-3')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/send-follow-ups/route.ts<br>
                            <strong>Lines:</strong> 135-150<br>
                            <strong>Array:</strong> tenQuestionVariations[2]
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('10q-3', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('10q-3', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="10q-3-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div style="padding: 20px; background: #f5f5f5;">
                                    <div style="background: white; padding: 30px; border-radius: 8px;">
                                        <div id="10q-3-preview-subject" style="font-weight: bold; font-size: 18px; margin-bottom: 20px; color: #1f3a33;">
                                            Last call: Get your 3rd prize draw entry
                                        </div>
                                        <div id="10q-3-preview-body" style="line-height: 1.6; white-space: pre-wrap; color: #333;">Hi John,

This is your final reminder to maximize your prize draw entries!

You currently have 2 entries. Complete the extended survey to earn your 3rd entry.

It takes just 2 minutes: https://smilemoore.co.uk?email=10q-3

Thank you,
Smile Moore Team</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CHRISTMAS TAB -->
            <div id="christmas" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">Christmas Sharing Email</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: 3 entries</span>
                    <span class="tag tag-timing">Send: Immediate</span>
                    <span class="tag tag-entries">Referral incentive</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="christmas-subject"
                                   value="üéÑ Spread Christmas Joy - Share Your ¬£50 Voucher!"
                                   oninput="updatePreview('christmas')">
                        </div>

                        <div class="form-group">
                            <label>Email Body</label>
                            <textarea id="christmas-body" style="min-height: 350px;" oninput="updatePreview('christmas')">Hi [Name],

The festive season is here! üéÑ‚ú®

We noticed you claimed your ¬£50 voucher - why not spread some Christmas joy to your family and friends?

üéÅ Give the Gift of a Healthy Smile This Christmas

Who else do you know who may also want this? Share your unique referral link and:
‚Ä¢ Help your loved ones save ¬£50 on dental care
‚Ä¢ Earn +10 bonus entries in the prize draw for EACH friend who claims their voucher
‚Ä¢ Perfect timing before the Christmas period!

Your Referral Link: https://smilemoore.co.uk?ref=[Name]-[Code]

The more you share, the better your chances of winning 1 Year of FREE Dentistry worth up to ¬£5,000!

Wishing you a wonderful festive season,
Smile Moore Team üéÖ</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('christmas', 0)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('christmas')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/send-follow-ups/route.ts<br>
                            <strong>Lines:</strong> 76-100<br>
                            <strong>Variable:</strong> christmasSharingEmail
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('christmas', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('christmas', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="christmas-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div style="padding: 20px; background: #f5f5f5;">
                                    <div style="background: white; padding: 30px; border-radius: 8px;">
                                        <div id="christmas-preview-subject" style="font-weight: bold; font-size: 18px; margin-bottom: 20px; color: #1f3a33;">
                                            üéÑ Spread Christmas Joy - Share Your ¬£50 Voucher!
                                        </div>
                                        <div id="christmas-preview-body" style="line-height: 1.6; white-space: pre-wrap; color: #333;">Hi John,

The festive season is here! üéÑ‚ú®

We noticed you claimed your ¬£50 voucher - why not spread some Christmas joy to your family and friends?

üéÅ Give the Gift of a Healthy Smile This Christmas

Who else do you know who may also want this? Share your unique referral link and:
‚Ä¢ Help your loved ones save ¬£50 on dental care
‚Ä¢ Earn +10 bonus entries in the prize draw for EACH friend who claims their voucher
‚Ä¢ Perfect timing before the Christmas period!

Your Referral Link: https://smilemoore.co.uk?ref=John-123

The more you share, the better your chances of winning 1 Year of FREE Dentistry worth up to ¬£5,000!

Wishing you a wonderful festive season,
Smile Moore Team üéÖ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REFERRAL FOLLOW-UP TAB -->
            <div id="referral" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">Referral Code Follow-up</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: Manual/Scheduled</span>
                    <span class="tag tag-timing">Send: As needed</span>
                    <span class="tag tag-entries">Encourage sharing</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="referral-subject"
                                   value="üéÅ Earn +10 Entries for Every Friend You Refer!"
                                   oninput="updatePreview('referral')">
                        </div>

                        <div class="form-group">
                            <label>Email Body</label>
                            <textarea id="referral-body" style="min-height: 300px;" oninput="updatePreview('referral')">Hi [Name],

We hope you're excited about your ¬£50 voucher! üéâ

Did you know you can BOOST your chances of winning 1 Year of FREE Dentistry?

üîó Share Your Unique Referral Link:
https://smilemoore.co.uk?ref=[Name]-[Code]

For every friend or family member who claims their voucher using your link, you'll receive:
‚úì +10 bonus entries in the prize draw
‚úì Help your loved ones save ¬£50 on dental care
‚úì Build your community of healthy smiles

The more you share, the better your chances!

Currently, you have [ENTRIES] entries. Imagine how many more you could earn!

Start sharing today,
Smile Moore Team</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('referral', 0)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('referral')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> New template - requires implementation<br>
                            <strong>Location:</strong> Can be added to send-follow-ups/route.ts<br>
                            <strong>Note:</strong> Currently manual - automation pending
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('referral', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('referral', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="referral-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div style="padding: 20px; background: #f5f5f5;">
                                    <div style="background: white; padding: 30px; border-radius: 8px;">
                                        <div id="referral-preview-subject" style="font-weight: bold; font-size: 18px; margin-bottom: 20px; color: #1f3a33;">
                                            üéÅ Earn +10 Entries for Every Friend You Refer!
                                        </div>
                                        <div id="referral-preview-body" style="line-height: 1.6; white-space: pre-wrap; color: #333;">Hi John,

We hope you're excited about your ¬£50 voucher! üéâ

Did you know you can BOOST your chances of winning 1 Year of FREE Dentistry?

üîó Share Your Unique Referral Link:
https://smilemoore.co.uk?ref=John-123

For every friend or family member who claims their voucher using your link, you'll receive:
‚úì +10 bonus entries in the prize draw
‚úì Help your loved ones save ¬£50 on dental care
‚úì Build your community of healthy smiles

The more you share, the better your chances!

Currently, you have 3 entries. Imagine how many more you could earn!

Start sharing today,
Smile Moore Team</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VOUCHER SINGLE TAB -->
            <div id="voucher-single" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">Voucher Confirmation (Single Signup)</h2>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: Postcode submitted</span>
                    <span class="tag tag-timing">Send: Immediate</span>
                    <span class="tag tag-entries">User has: 1 entry</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="voucher-single-subject"
                                   value="Your ¬£50 Voucher is Confirmed! üéâ"
                                   oninput="updatePreview('voucher-single')">
                        </div>

                        <div class="form-group">
                            <label>Email Heading</label>
                            <input type="text" id="voucher-single-heading"
                                   value="Congratulations, [Name]! üéâ"
                                   oninput="updatePreview('voucher-single')">
                        </div>

                        <div class="form-group">
                            <label>Opening Message</label>
                            <textarea id="voucher-single-opening" style="min-height: 100px;" oninput="updatePreview('voucher-single')">Thank you for claiming your voucher! Your ¬£50 voucher is confirmed and ready to use.</textarea>
                        </div>

                        <div class="form-group">
                            <label>Prize Entry Message</label>
                            <textarea id="voucher-single-prize" style="min-height: 120px;" oninput="updatePreview('voucher-single')">üéÅ You're Entered to Win!

You have 3 entries in our draw to win 1 Year of FREE Dentistry worth up to ¬£5,000!

Want +10 bonus entries? Share your unique referral link with friends!</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('voucher-single', 0)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('voucher-single')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/update-voucher/route.ts<br>
                            <strong>Lines:</strong> ~240-385<br>
                            <strong>Note:</strong> Complex HTML template
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('voucher-single', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('voucher-single', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="voucher-single-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div class="email-header">
                                    <h2>Smile Moore</h2>
                                </div>
                                <div class="email-body">
                                    <h3 id="voucher-single-preview-heading">Congratulations, John! üéâ</h3>
                                    <p id="voucher-single-preview-opening">Thank you for claiming your voucher! Your ¬£50 voucher is confirmed and ready to use.</p>

                                    <div class="voucher-code">
                                        <p style="margin-bottom: 10px; font-size: 14px; color: #1f3a33; font-weight: bold;">YOUR VOUCHER CODE</p>
                                        <div class="voucher-code-text">SMILEABC123</div>
                                    </div>

                                    <h3>What Happens Next?</h3>
                                    <ul style="line-height: 1.8; color: #333;">
                                        <li>Keep this voucher code safe - you'll need it when we open!</li>
                                        <li>We'll keep you updated as we complete our CQC approval process</li>
                                        <li>You'll receive updates throughout our practice fit-out</li>
                                        <li>Once we're ready to see our first patients, we'll send you a booking link</li>
                                        <li>Use your voucher code when booking to redeem your ¬£50 discount</li>
                                        <li>Bonus: Receive +100 prize draw entries when you redeem your voucher!</li>
                                    </ul>

                                    <div class="prize-box">
                                        <div id="voucher-single-preview-prize" style="white-space: pre-wrap;">üéÅ You're Entered to Win!

You have 3 entries in our draw to win 1 Year of FREE Dentistry worth up to ¬£5,000!

Want +10 bonus entries? Share your unique referral link with friends!</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VOUCHER FAMILY TAB -->
            <div id="voucher-family" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">Voucher Confirmation (Family - Multiple Signups)</h2>

                <div class="info-box">
                    <h3>üõ°Ô∏è Inbox Protection</h3>
                    <p><strong>Only ONE email is sent</strong> when multiple family members use the same email address. The system automatically detects duplicate emails and consolidates all voucher codes into a single, organized email.</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <span class="tag tag-trigger">Trigger: Same email multiple times</span>
                    <span class="tag tag-timing">Send: On completion</span>
                    <span class="tag tag-entries">Deduplication: Active</span>
                </div>

                <div class="editor-layout">
                    <div class="editor-panel">
                        <h3>‚úèÔ∏è Edit Template</h3>

                        <div class="form-group">
                            <label>Subject Line</label>
                            <input type="text" id="voucher-family-subject"
                                   value="Your Family Vouchers are Confirmed! üéâ"
                                   oninput="updatePreview('voucher-family')">
                        </div>

                        <div class="form-group">
                            <label>Email Heading</label>
                            <input type="text" id="voucher-family-heading"
                                   value="Congratulations! üéâ"
                                   oninput="updatePreview('voucher-family')">
                        </div>

                        <div class="form-group">
                            <label>Opening Message</label>
                            <textarea id="voucher-family-opening" style="min-height: 100px;" oninput="updatePreview('voucher-family')">Thank you for claiming vouchers for your family! You've registered [COUNT] people with a total value of ¬£[TOTAL].</textarea>
                        </div>

                        <div class="form-group">
                            <label>Prize Entry Message</label>
                            <textarea id="voucher-family-prize" style="min-height: 120px;" oninput="updatePreview('voucher-family')">üéÅ You're Entered to Win!

Each family member has 3 entries in our draw to win 1 Year of FREE Dentistry worth up to ¬£5,000!</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveTemplate('voucher-family', 0)">
                                üíæ Save & Deploy
                            </button>
                            <button class="btn btn-secondary" onclick="resetTemplate('voucher-family')">
                                ‚Ü∫ Reset
                            </button>
                        </div>

                        <div class="code-location" style="margin-top: 20px;">
                            <strong>File:</strong> app/api/update-voucher/route.ts<br>
                            <strong>Lines:</strong> ~240-385<br>
                            <strong>Logic:</strong> isMultiple = true
                        </div>
                    </div>

                    <div class="preview-panel">
                        <div class="preview-controls">
                            <span style="font-weight: 600; color: #1f3a33; margin-right: auto;">Live Preview</span>
                            <button onclick="setPreviewMode('voucher-family', 'mobile')">üì± Mobile</button>
                            <button class="active" onclick="setPreviewMode('voucher-family', 'desktop')">üíª Desktop</button>
                        </div>
                        <div id="voucher-family-preview" class="preview-viewport desktop">
                            <div class="email-preview">
                                <div class="email-header">
                                    <h2>Smile Moore</h2>
                                </div>
                                <div class="email-body">
                                    <h3 id="voucher-family-preview-heading">Congratulations! üéâ</h3>
                                    <p id="voucher-family-preview-opening">Thank you for claiming vouchers for your family! You've registered 3 people with a total value of ¬£150.</p>

                                    <table class="family-table">
                                        <thead>
                                            <tr>
                                                <th>Family Member</th>
                                                <th>Voucher Code</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>John Smith</td>
                                                <td style="font-family: 'Courier New', monospace; font-weight: bold;">SMILEABC123</td>
                                                <td style="color: #70d490; font-weight: bold;">¬£50</td>
                                            </tr>
                                            <tr>
                                                <td>Jane Smith</td>
                                                <td style="font-family: 'Courier New', monospace; font-weight: bold;">SMILEDEF456</td>
                                                <td style="color: #70d490; font-weight: bold;">¬£50</td>
                                            </tr>
                                            <tr>
                                                <td>Tom Smith</td>
                                                <td style="font-family: 'Courier New', monospace; font-weight: bold;">SMILEGHI789</td>
                                                <td style="color: #70d490; font-weight: bold;">¬£50</td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <div class="prize-box">
                                        <div id="voucher-family-preview-prize" style="white-space: pre-wrap;">üéÅ You're Entered to Win!

Each family member has 3 entries in our draw to win 1 Year of FREE Dentistry worth up to ¬£5,000!</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WHATSAPP AUTOMATION TAB -->
            <div id="whatsapp" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">üí¨ WhatsApp Automation</h2>

                <div class="info-box">
                    <h3>üì± WhatsApp Business API</h3>
                    <p>Automated WhatsApp messages can be sent for voucher confirmations, follow-ups, and referral reminders. Requires WhatsApp Business API integration.</p>
                    <p><strong>Note:</strong> Templates below are view-only reference. Full editing capability coming soon.</p>
                </div>

                <div class="stats" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="number">5</div>
                        <div class="label">Message Templates</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">98%</div>
                        <div class="label">Open Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">‚ö°</div>
                        <div class="label">Instant Delivery</div>
                    </div>
                </div>

                <h3 style="color: #1f3a33; margin-bottom: 15px;">Available WhatsApp Templates</h3>

                <div style="display: grid; gap: 20px;">
                    <!-- WhatsApp Template 1: Voucher Confirmation -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #25D366;">
                        <h4 style="color: #1f3a33; margin-bottom: 10px;">1. Voucher Confirmation</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">
Hi *[Name]* üëã

üéâ Your ¬£50 voucher is confirmed!

*Voucher Code:* [CODE]

You now have *3 entries* in our prize draw to win 1 Year of FREE Dentistry worth up to ¬£5,000! üèÜ

Share your referral link to earn +10 bonus entries per friend:
https://smilemoore.co.uk?ref=[Name]-[Code]

- Smile Moore Team
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="tag tag-trigger">Trigger: Voucher claimed</span>
                            <span class="tag tag-timing">Send: Immediate</span>
                        </div>
                    </div>

                    <!-- WhatsApp Template 2: Survey Reminder -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #25D366;">
                        <h4 style="color: #1f3a33; margin-bottom: 10px;">2. Survey Reminder (4Q)</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">
Hi *[Name]* üëã

Quick reminder! Complete 4 questions to get +1 bonus entry üéÅ

Takes just 60 seconds:
https://smilemoore.co.uk?email=christmas

Thanks!
- Smile Moore Team
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="tag tag-trigger">Trigger: 1 entry, email not opened</span>
                            <span class="tag tag-timing">Send: 48hrs after email</span>
                        </div>
                    </div>

                    <!-- WhatsApp Template 3: Referral Reminder -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #25D366;">
                        <h4 style="color: #1f3a33; margin-bottom: 10px;">3. Referral Reminder</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">
Hi *[Name]* üéâ

Did you know? You earn *+10 entries* for EVERY friend who claims their voucher using your link! üîó

Your referral link:
https://smilemoore.co.uk?ref=[Name]-[Code]

Currently: *[ENTRIES] entries*

Share with friends & family to boost your chances! üöÄ

- Smile Moore Team
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="tag tag-trigger">Trigger: Manual/Scheduled</span>
                            <span class="tag tag-timing">Send: As needed</span>
                        </div>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <h3>üõ†Ô∏è Implementation Required</h3>
                    <p><strong>To enable WhatsApp automation:</strong><br>
                    1. Set up WhatsApp Business API account<br>
                    2. Get templates approved by WhatsApp<br>
                    3. Integrate with Twilio/MessageBird/WhatsApp Cloud API<br>
                    4. Add phone number collection to signup form<br>
                    5. Configure automation triggers in send-follow-ups route</p>
                </div>
            </div>

            <!-- SMS AUTOMATION TAB -->
            <div id="sms" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">üì± SMS/Text Automation</h2>

                <div class="info-box">
                    <h3>üí¨ SMS Messaging</h3>
                    <p>Automated text messages for instant notifications and reminders. High open rates and immediate delivery via Twilio SMS API.</p>
                    <p><strong>Note:</strong> Templates below are view-only reference. Full editing capability coming soon.</p>
                </div>

                <div class="stats" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="number">5</div>
                        <div class="label">SMS Templates</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">99%</div>
                        <div class="label">Delivery Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">3min</div>
                        <div class="label">Avg. Read Time</div>
                    </div>
                </div>

                <h3 style="color: #1f3a33; margin-bottom: 15px;">Available SMS Templates</h3>

                <div style="display: grid; gap: 20px;">
                    <!-- SMS Template 1: Voucher Confirmation -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #0084FF;">
                        <h4 style="color: #1f3a33; margin-bottom: 10px;">1. Voucher Confirmation (160 chars)</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">
Smile Moore: Your ¬£50 voucher [CODE] is confirmed! You have 3 entries to win FREE dentistry worth ¬£5,000. Reply SHARE for your referral link.
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="tag tag-trigger">Trigger: Voucher claimed</span>
                            <span class="tag tag-timing">Send: Immediate</span>
                            <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #e8f5e9; color: #2e7d32;">160 chars</span>
                        </div>
                    </div>

                    <!-- SMS Template 2: Survey Reminder -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #0084FF;">
                        <h4 style="color: #1f3a33; margin-bottom: 10px;">2. Quick Survey Reminder (142 chars)</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">
Smile Moore: Complete 4 quick questions for +1 bonus entry! Takes 60 seconds: https://smilemoore.co.uk?sms=4q-1 - You currently have [ENTRIES] entries
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="tag tag-trigger">Trigger: 1 entry</span>
                            <span class="tag tag-timing">Send: 48hrs after email</span>
                            <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #e8f5e9; color: #2e7d32;">142 chars</span>
                        </div>
                    </div>

                    <!-- SMS Template 3: Referral Boost -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #0084FF;">
                        <h4 style="color: #1f3a33; margin-bottom: 10px;">3. Referral Reminder (155 chars)</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">
Smile Moore: Earn +10 entries per friend! Share: https://smilemoore.co.uk?ref=[Name]-[Code] You have [ENTRIES] entries. Keep sharing to win! üéâ
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="tag tag-trigger">Trigger: Manual/Scheduled</span>
                            <span class="tag tag-timing">Send: As needed</span>
                            <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #fff3e0; color: #f57c00;">155 chars</span>
                        </div>
                    </div>

                    <!-- SMS Template 4: Prize Draw Reminder -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #0084FF;">
                        <h4 style="color: #1f3a33; margin-bottom: 10px;">4. Extended Survey (10Q) (148 chars)</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">
Smile Moore: Want 3 total entries? Complete the extended survey for +1 more entry: https://smilemoore.co.uk?sms=10q-1 Currently: [ENTRIES] entries üèÜ
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="tag tag-trigger">Trigger: 2 entries</span>
                            <span class="tag tag-timing">Send: Immediate</span>
                            <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #e8f5e9; color: #2e7d32;">148 chars</span>
                        </div>
                    </div>

                    <!-- SMS Template 5: Christmas Sharing -->
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #0084FF;">
                        <h4 style="color: #1f3a33; margin-bottom: 10px;">5. Christmas Sharing (145 chars)</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6;">
Smile Moore: üéÑ Spread Christmas joy! Share your ¬£50 voucher link & earn +10 entries per friend: https://smilemoore.co.uk?ref=[Name]-[Code] üéÅ
                        </div>
                        <div style="margin-top: 10px;">
                            <span class="tag tag-trigger">Trigger: 3 entries</span>
                            <span class="tag tag-timing">Send: Christmas period</span>
                            <span style="display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #e8f5e9; color: #2e7d32;">145 chars</span>
                        </div>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <h3>üõ†Ô∏è Implementation Required</h3>
                    <p><strong>To enable SMS automation:</strong><br>
                    1. Sign up for Twilio account (or alternative: AWS SNS, MessageBird)<br>
                    2. Purchase UK phone number for sender ID<br>
                    3. Configure Twilio API credentials in environment variables<br>
                    4. Add phone number field to signup form (with validation)<br>
                    5. Create SMS sending route (app/api/send-sms/route.ts)<br>
                    6. Add SMS triggers to send-follow-ups automation<br>
                    7. Ensure GDPR compliance (SMS opt-in checkbox)</p>
                </div>

                <div class="info-box" style="background: #fff3e0; border-left-color: #f57c00;">
                    <h3>üí∑ Cost Estimate</h3>
                    <p><strong>UK SMS Pricing (Twilio):</strong> ~¬£0.04 per message<br>
                    For 1,000 signups with 3 SMS each = ¬£120/month<br>
                    <br>
                    <strong>Recommended:</strong> Use SMS sparingly for high-priority messages only (voucher confirmation, final reminders). Use email as primary channel to minimize costs.</p>
                </div>
            </div>

            <!-- FUNNEL CONTENT TAB -->
            <div id="funnel" class="email-card">
                <h2 style="color: #1f3a33; margin-bottom: 20px;">üéØ Funnel Content Editor</h2>

                <div class="info-box">
                    <h3>üìù Edit Funnel Pages</h3>
                    <p>Manage headlines, descriptions, and call-to-action text for both funnel pages: Main (/) and Early Bird (/earlybird).</p>
                </div>

                <!-- Funnel Selector & Actions -->
                <div style="display: flex; gap: 15px; align-items: center; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <div style="flex: 1;">
                        <label style="font-weight: 600; color: #1f3a33; margin-bottom: 8px; display: block;">Select Funnel:</label>
                        <select id="funnel-selector" onchange="switchFunnel()" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px; font-weight: 600;">
                            <option value="main">üè† Main Funnel (/)</option>
                            <option value="earlybird">üê¶ Early Bird Funnel (/earlybird)</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="saveAndPushFunnel()" style="white-space: nowrap;">
                            üöÄ Save & Push Live
                        </button>
                        <button class="btn btn-secondary" onclick="syncFunnels()" style="white-space: nowrap; background: #70d490; color: white; border: none;">
                            üîÑ Sync Both Funnels
                        </button>
                    </div>
                </div>

                <!-- Main Funnel Editor -->
                <div id="funnel-main-editor" style="display: grid; gap: 30px;">

                    <!-- Homepage Hero Section -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #70d490;">
                        <h3 style="color: #1f3a33; margin-bottom: 20px;">üè† Homepage Hero Section</h3>

                        <div class="form-group">
                            <label>Main Headline</label>
                            <input type="text" id="funnel-main-hero-headline"
                                   value="Claim Your ¬£50 Voucher Today!"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 16px; font-weight: bold;">
                        </div>

                        <div class="form-group">
                            <label>Subheadline</label>
                            <textarea id="funnel-main-hero-subheadline"
                                      style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 80px;">Join hundreds of local families who have already claimed their voucher. Plus, enter our prize draw to win 1 Year of FREE Dentistry worth up to ¬£5,000!</textarea>
                        </div>

                        <div class="form-group">
                            <label>CTA Button Text</label>
                            <input type="text" id="funnel-main-hero-cta"
                                   value="Claim My ¬£50 Voucher"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px;">
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveWebsiteContent('hero')">
                                üíæ Save & Update Website
                            </button>
                            <button class="btn btn-secondary" onclick="resetWebsiteContent('hero')">
                                ‚Ü∫ Reset
                            </button>
                        </div>
                    </div>

                    <!-- Prize Draw Section -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #70d490;">
                        <h3 style="color: #1f3a33; margin-bottom: 20px;">üéÅ Prize Draw Section</h3>

                        <div class="form-group">
                            <label>Section Headline</label>
                            <input type="text" id="funnel-main-prize-headline"
                                   value="Win 1 Year of FREE Dentistry!"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 16px; font-weight: bold;">
                        </div>

                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="funnel-main-prize-description"
                                      style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Enter our exclusive prize draw for a chance to win 1 Year of FREE Dentistry worth up to ¬£5,000! Simply claim your voucher and answer a few quick questions to earn entries.</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveWebsiteContent('prize')">
                                üíæ Save & Update Website
                            </button>
                            <button class="btn btn-secondary" onclick="resetWebsiteContent('prize')">
                                ‚Ü∫ Reset
                            </button>
                        </div>
                    </div>

                    <!-- Referral Section -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #70d490;">
                        <h3 style="color: #1f3a33; margin-bottom: 20px;">üîó Referral Section</h3>

                        <div class="form-group">
                            <label>Section Headline</label>
                            <input type="text" id="funnel-main-referral-headline"
                                   value="Share & Earn Bonus Entries!"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 16px; font-weight: bold;">
                        </div>

                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="funnel-main-referral-description"
                                      style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Earn +10 bonus entries for every friend or family member who claims their voucher using your unique referral link. The more you share, the better your chances of winning!</textarea>
                        </div>

                        <div class="button-group">
                            <button class="btn btn-primary" onclick="saveWebsiteContent('referral')">
                                üíæ Save & Update Website
                            </button>
                            <button class="btn btn-secondary" onclick="resetWebsiteContent('referral')">
                                ‚Ü∫ Reset
                            </button>
                        </div>
                    </div>

                </div>

                <!-- Early Bird Funnel Editor -->
                <div id="funnel-earlybird-editor" style="display: none; gap: 30px;">
                    <!-- Hero Section -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #70d490;">
                        <h3 style="color: #1f3a33; margin-bottom: 20px;">üè† Hero Section</h3>

                        <div class="form-group">
                            <label>Main Headline</label>
                            <input type="text" id="funnel-earlybird-hero-headline"
                                   value="Claim Your ¬£50 Voucher Today!"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 16px; font-weight: bold;">
                        </div>

                        <div class="form-group">
                            <label>Subheadline</label>
                            <textarea id="funnel-earlybird-hero-subheadline"
                                      style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 80px;">Join hundreds of local families who have already claimed their voucher. Plus, enter our prize draw to win 1 Year of FREE Dentistry worth up to ¬£5,000!</textarea>
                        </div>

                        <div class="form-group">
                            <label>CTA Button Text</label>
                            <input type="text" id="funnel-earlybird-hero-cta"
                                   value="Claim My ¬£50 Voucher"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px;">
                        </div>
                    </div>

                    <!-- Prize Draw Section -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #70d490;">
                        <h3 style="color: #1f3a33; margin-bottom: 20px;">üéÅ Prize Draw Section</h3>

                        <div class="form-group">
                            <label>Section Headline</label>
                            <input type="text" id="funnel-earlybird-prize-headline"
                                   value="Win 1 Year of FREE Dentistry!"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 16px; font-weight: bold;">
                        </div>

                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="funnel-earlybird-prize-description"
                                      style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Enter our exclusive prize draw for a chance to win 1 Year of FREE Dentistry worth up to ¬£5,000! Simply claim your voucher and answer a few quick questions to earn entries.</textarea>
                        </div>
                    </div>

                    <!-- Referral Section -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #70d490;">
                        <h3 style="color: #1f3a33; margin-bottom: 20px;">üîó Referral Section</h3>

                        <div class="form-group">
                            <label>Section Headline</label>
                            <input type="text" id="funnel-earlybird-referral-headline"
                                   value="Share & Earn Bonus Entries!"
                                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 16px; font-weight: bold;">
                        </div>

                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="funnel-earlybird-referral-description"
                                      style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Earn +10 bonus entries for every friend or family member who claims their voucher using your unique referral link. The more you share, the better your chances of winning!</textarea>
                        </div>
                    </div>
                </div>

                <!-- Survey Questions Editor -->
                <div style="background: #fff; padding: 25px; border-radius: 8px; border: 2px solid #70d490; margin-top: 30px;">
                    <h3 style="color: #1f3a33; margin-bottom: 20px;">üìã Survey Questions (Step 5 & 6)</h3>

                    <div class="info-box" style="background: #e8f5e9;">
                        <p><strong>Note:</strong> These questions appear in the multi-step form. Edit questions and answer options below.</p>
                    </div>

                    <!-- Step 5: First 5 Questions -->
                    <div style="margin-top: 25px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <h4 style="color: #1f3a33; margin-bottom: 15px;">Step 5: First 5 Questions</h4>

                        <!-- Question 1 -->
                        <div class="form-group">
                            <label><strong>Question 1:</strong> When do you usually prefer appointments?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 120px;">Weekday mornings
Weekday afternoons
Weekday evenings (after 5pm)
Saturdays
Sundays</textarea>
                            <small style="color: #666;">One option per line. This is a multiple choice question.</small>
                        </div>

                        <!-- Question 2 -->
                        <div class="form-group">
                            <label><strong>Question 2:</strong> When was your most recent appointment?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Within the last 6 months
6 months to 1 year ago
1-2 years ago
More than 2 years ago
I've never been to the dentist</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 3 -->
                        <div class="form-group">
                            <label><strong>Question 3:</strong> What type of dental care are you most interested in?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 120px;">Routine check-ups and cleanings
Cosmetic dentistry (e.g., whitening, veneers)
Orthodontics (e.g., braces, Invisalign)
Restorative work (e.g., fillings, crowns)
Emergency dental care
Specialist treatments (e.g., implants, root canals)</textarea>
                            <small style="color: #666;">One option per line. This is a multiple choice question.</small>
                        </div>

                        <!-- Question 4 -->
                        <div class="form-group">
                            <label><strong>Question 4:</strong> How do you feel about visiting the dentist?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 80px;">I feel comfortable and relaxed
I feel slightly anxious
I feel very nervous or anxious
I avoid it due to fear or bad experiences</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 5 -->
                        <div class="form-group">
                            <label><strong>Question 5:</strong> What's the main reason for looking for a new dentist?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 120px;">I'm new to the area
Dissatisfied with my current dentist
Looking for better prices or payment plans
Need a specific treatment or specialist
My previous practice closed or stopped taking NHS patients
Other</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>
                    </div>

                    <!-- Step 6: Extended 10 Questions -->
                    <div style="margin-top: 25px; padding: 20px; background: #fff3e0; border-radius: 8px;">
                        <h4 style="color: #1f3a33; margin-bottom: 15px;">Step 6: Extended 10 Questions</h4>

                        <!-- Question 6 -->
                        <div class="form-group">
                            <label><strong>Question 6:</strong> How would you describe your previous experience with dental practices?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Mostly positive
Mixed experiences
Mostly negative
I've avoided going for a while
I feel nervous about dental visits</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 7 -->
                        <div class="form-group">
                            <label><strong>Question 7:</strong> When thinking about dental care, which factor matters most to you?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 120px;">Feeling listened to
Pain-free treatment
Clear explanations
Availability of appointments
Cost transparency
A calm, modern clinic environment</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 8 -->
                        <div class="form-group">
                            <label><strong>Question 8:</strong> How confident do you currently feel about your smile?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Very confident
Mostly confident
A little self-conscious
Not confident
I'd like help improving it</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 9 -->
                        <div class="form-group">
                            <label><strong>Question 9:</strong> How important is seeing the same clinician each time?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 80px;">Essential
Preferable
Not important
Depends on the treatment</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 10 -->
                        <div class="form-group">
                            <label><strong>Question 10:</strong> What types of treatments do you think you may need in the next year?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 140px;">Hygienist visits
Check-ups
Whitening
Composite bonding / veneers
Teeth straightening (e.g., aligners)
Fillings / crowns / restorative work
Not sure ‚Äî I need guidance</textarea>
                            <small style="color: #666;">One option per line. This is a multiple choice question.</small>
                        </div>

                        <!-- Question 11 -->
                        <div class="form-group">
                            <label><strong>Question 11:</strong> How do you usually feel before a dental appointment?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Relaxed
Neutral
Slightly anxious
Very anxious
I often delay or avoid going</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 12 -->
                        <div class="form-group">
                            <label><strong>Question 12:</strong> What would make you more likely to stay with a dental practice long-term?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 120px;">Consistency of clinician
Clear pricing & no surprises
Flexible appointment times
Gentle, patient-focused approach
Quick availability
Modern technology & facilities</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 13 -->
                        <div class="form-group">
                            <label><strong>Question 13:</strong> What prevents you from attending the dentist as often as you'd like?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 120px;">Cost
Time / busy schedule
Anxiety
Difficulty getting appointments
Not had a practice I felt comfortable with
Nothing stops me</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 14 -->
                        <div class="form-group">
                            <label><strong>Question 14:</strong> How important is it that your dental practice offers cosmetic options?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">Very important
Somewhat important
Neutral
Not important
Unsure</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Question 15 -->
                        <div class="form-group">
                            <label><strong>Question 15:</strong> How do you prefer to receive updates or reminders?</label>
                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px;">WhatsApp
Email
Text message
Phone call
No preference</textarea>
                            <small style="color: #666;">One option per line. This is a single choice question.</small>
                        </div>

                        <!-- Additional Feedback -->
                        <div class="form-group">
                            <label><strong>Additional Feedback (Optional):</strong> Anything else you'd like us to know?</label>
                            <input type="text" value="Share any thoughts, preferences, or concerns..." style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px;" disabled>
                            <small style="color: #666;">This is a free-text field. Placeholder text shown above.</small>
                        </div>
                    </div>

                    <div class="button-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="saveSurveyQuestions()">
                            üíæ Save Survey Questions
                        </button>
                        <button class="btn btn-secondary" onclick="resetSurveyQuestions()">
                            ‚Ü∫ Reset to Defaults
                        </button>
                    </div>

                    <div class="info-box" style="margin-top: 20px; background: #fff3e0;">
                        <p><strong>‚ö†Ô∏è Important:</strong> Changing survey questions requires updating app/page.tsx. This feature shows current questions for reference. To update questions, contact development team or edit directly in code.</p>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <h3>üõ†Ô∏è Funnel Updates</h3>
                    <p><strong>üöÄ Save & Push Live:</strong> Saves the current funnel and deploys to production immediately.<br>
                    <strong>üîÑ Sync Both Funnels:</strong> Copies content from Main (/) to Early Bird (/earlybird) and saves both.<br>
                    <br>
                    Files updated:<br>
                    ‚Ä¢ Main Funnel: app/page.tsx<br>
                    ‚Ä¢ Early Bird Funnel: app/earlybird/page.tsx</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Store original templates
        const originalTemplates = {
            'voucher-single': {
                subject: 'Your ¬£50 Voucher is Confirmed! üéâ',
                heading: 'Congratulations, [Name]! üéâ',
                opening: 'Thank you for claiming your voucher! Your ¬£50 voucher is confirmed and ready to use.',
                prize: `üéÅ You're Entered to Win!

You have 3 entries in our draw to win 1 Year of FREE Dentistry worth up to ¬£5,000!

Want +10 bonus entries? Share your unique referral link with friends!`
            },
            'voucher-family': {
                subject: 'Your Family Vouchers are Confirmed! üéâ',
                heading: 'Congratulations! üéâ',
                opening: 'Thank you for claiming vouchers for your family! You\'ve registered [COUNT] people with a total value of ¬£[TOTAL].',
                prize: `üéÅ You're Entered to Win!

Each family member has 3 entries in our draw to win 1 Year of FREE Dentistry worth up to ¬£5,000!`
            },
            '4q-1': {
                subject: 'üéÅ Quick reminder: Boost your prize draw entries!',
                body: `Hi [Name],

We noticed you claimed your ¬£50 voucher but haven't entered the prize draw yet!

It only takes 1 minute to answer 4 quick questions and you'll receive +1 bonus entry.

Click here to complete: https://smilemoore.co.uk?email=4q-1

Thank you!
Smile Moore Team`
            },
            '4q-2': {
                subject: 'Don\'t miss out on winning up to ¬£5,000 of free dentistry!',
                body: `Hi [Name],

You're so close! Complete 4 simple questions to enter the draw for 1 Year of FREE Dentistry worth up to ¬£5,000.

Plus, you'll earn another entry bringing your total to 2 entries.

Complete now: https://smilemoore.co.uk?email=4q-2

Best regards,
Smile Moore Team`
            },
            '4q-3': {
                subject: 'Final chance: Enter the prize draw',
                body: `Hi [Name],

This is your last reminder to enter the prize draw worth up to ¬£5,000!

4 quick questions = +1 entry in the draw
Takes less than 60 seconds

Complete your entry: https://smilemoore.co.uk?email=4q-3

Thank you,
Smile Moore Team`
            },
            '10q-1': {
                subject: 'üåü One more step to maximize your prize entries!',
                body: `Hi [Name],

Great job completing the first questions! You now have 2 entries in the prize draw worth up to ¬£5,000.

Want to increase your chances? Answer 10 more quick questions and earn +1 bonus entry (3 entries total).

Continue here: https://smilemoore.co.uk?email=10q-1

Thank you!
Smile Moore Team`
            },
            '10q-2': {
                subject: 'Help us build your perfect dental practice',
                body: `Hi [Name],

Your feedback is incredibly valuable! We'd love to hear more about your dental preferences.

Complete 10 additional questions and you'll receive:
‚Ä¢ +1 bonus entry in the prize draw (3 total)
‚Ä¢ Help shape your perfect dental experience

Share your thoughts: https://smilemoore.co.uk?email=10q-2

Best regards,
Smile Moore Team`
            },
            '10q-3': {
                subject: 'Last call: Get your 3rd prize draw entry',
                body: `Hi [Name],

This is your final reminder to maximize your prize draw entries!

You currently have 2 entries. Complete the extended survey to earn your 3rd entry.

It takes just 2 minutes: https://smilemoore.co.uk?email=10q-3

Thank you,
Smile Moore Team`
            },
            'christmas': {
                subject: 'üéÑ Spread Christmas Joy - Share Your ¬£50 Voucher!',
                body: `Hi [Name],

The festive season is here! üéÑ‚ú®

We noticed you claimed your ¬£50 voucher - why not spread some Christmas joy to your family and friends?

üéÅ Give the Gift of a Healthy Smile This Christmas

Who else do you know who may also want this? Share your unique referral link and:
‚Ä¢ Help your loved ones save ¬£50 on dental care
‚Ä¢ Earn +10 bonus entries in the prize draw for EACH friend who claims their voucher
‚Ä¢ Perfect timing before the Christmas period!

Your Referral Link: https://smilemoore.co.uk?ref=[Name]-[Code]

The more you share, the better your chances of winning 1 Year of FREE Dentistry worth up to ¬£5,000!

Wishing you a wonderful festive season,
Smile Moore Team üéÖ`
            },
            'referral': {
                subject: 'üéÅ Earn +10 Entries for Every Friend You Refer!',
                body: `Hi [Name],

We hope you're excited about your ¬£50 voucher! üéâ

Did you know you can BOOST your chances of winning 1 Year of FREE Dentistry?

üîó Share Your Unique Referral Link:
https://smilemoore.co.uk?ref=[Name]-[Code]

For every friend or family member who claims their voucher using your link, you'll receive:
‚úì +10 bonus entries in the prize draw
‚úì Help your loved ones save ¬£50 on dental care
‚úì Build your community of healthy smiles

The more you share, the better your chances!

Currently, you have [ENTRIES] entries. Imagine how many more you could earn!

Start sharing today,
Smile Moore Team`
            }
        };

        function showTab(tabId) {
            document.querySelectorAll('.email-card').forEach(card => {
                card.classList.remove('active');
            });

            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');

            // Initialize preview if it has one
            if (document.getElementById(tabId + '-preview')) {
                updatePreview(tabId);
            }
        }

        function updatePreview(templateId) {
            // Handle voucher templates differently
            if (templateId === 'voucher-single' || templateId === 'voucher-family') {
                const headingInput = document.getElementById(templateId + '-heading');
                const openingInput = document.getElementById(templateId + '-opening');
                const prizeInput = document.getElementById(templateId + '-prize');

                const headingPreview = document.getElementById(templateId + '-preview-heading');
                const openingPreview = document.getElementById(templateId + '-preview-opening');
                const prizePreview = document.getElementById(templateId + '-preview-prize');

                if (headingInput && headingPreview) {
                    headingPreview.textContent = headingInput.value.replace(/\[Name\]/g, 'John');
                }

                if (openingInput && openingPreview) {
                    let text = openingInput.value;
                    text = text.replace(/\[COUNT\]/g, '3');
                    text = text.replace(/\[TOTAL\]/g, '150');
                    openingPreview.textContent = text;
                }

                if (prizeInput && prizePreview) {
                    prizePreview.textContent = prizeInput.value;
                }
            } else {
                // Handle standard templates
                const subjectInput = document.getElementById(templateId + '-subject');
                const bodyInput = document.getElementById(templateId + '-body');
                const subjectPreview = document.getElementById(templateId + '-preview-subject');
                const bodyPreview = document.getElementById(templateId + '-preview-body');

                if (subjectInput && subjectPreview) {
                    subjectPreview.textContent = subjectInput.value;
                }

                if (bodyInput && bodyPreview) {
                    // Replace [Name] with sample name for preview
                    let previewText = bodyInput.value.replace(/\[Name\]/g, 'John');
                    previewText = previewText.replace(/\[Code\]/g, '123');
                    bodyPreview.textContent = previewText;
                }
            }
        }

        function setPreviewMode(templateId, mode) {
            const preview = document.getElementById(templateId + '-preview');
            const buttons = preview.previousElementSibling.querySelectorAll('button');

            preview.className = 'preview-viewport ' + mode;

            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(mode === 'mobile' ? 'üì±' : 'üíª')) {
                    btn.classList.add('active');
                }
            });
        }

        function resetTemplate(templateId) {
            if (originalTemplates[templateId]) {
                if (templateId === 'voucher-single' || templateId === 'voucher-family') {
                    const subjectInput = document.getElementById(templateId + '-subject');
                    const headingInput = document.getElementById(templateId + '-heading');
                    const openingInput = document.getElementById(templateId + '-opening');
                    const prizeInput = document.getElementById(templateId + '-prize');

                    if (subjectInput) subjectInput.value = originalTemplates[templateId].subject;
                    if (headingInput) headingInput.value = originalTemplates[templateId].heading;
                    if (openingInput) openingInput.value = originalTemplates[templateId].opening;
                    if (prizeInput) prizeInput.value = originalTemplates[templateId].prize;
                } else {
                    const subjectInput = document.getElementById(templateId + '-subject');
                    const bodyInput = document.getElementById(templateId + '-body');

                    if (subjectInput) subjectInput.value = originalTemplates[templateId].subject;
                    if (bodyInput) bodyInput.value = originalTemplates[templateId].body;
                }

                updatePreview(templateId);
                showAlert('Template reset to original', 'info');
            }
        }

        async function saveTemplate(templateType, variation) {
            const templateId = templateType === 'voucher-single' || templateType === 'voucher-family'
                ? templateType
                : templateType + '-' + (variation + 1);

            // Show loading state
            event.target.disabled = true;
            event.target.innerHTML = '<span class="loading"></span> Saving...';

            try {
                if (templateType === 'voucher-single' || templateType === 'voucher-family') {
                    // Handle voucher templates
                    const subjectInput = document.getElementById(templateId + '-subject');
                    const headingInput = document.getElementById(templateId + '-heading');
                    const openingInput = document.getElementById(templateId + '-opening');
                    const prizeInput = document.getElementById(templateId + '-prize');

                    if (!subjectInput || !headingInput || !openingInput || !prizeInput) {
                        throw new Error('Template inputs not found');
                    }

                    const fields = [
                        { field: 'subject', value: subjectInput.value },
                        { field: 'heading', value: headingInput.value },
                        { field: 'opening', value: openingInput.value },
                        { field: 'prize', value: prizeInput.value }
                    ];

                    for (const { field, value } of fields) {
                        const response = await fetch('http://localhost:3000/api/update-email-template', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                templateType,
                                variation: '0',
                                field,
                                value
                            })
                        });

                        if (!response.ok) {
                            const error = await response.json();
                            throw new Error(error.error || `Failed to save ${field}`);
                        }
                    }

                    // Update original template
                    originalTemplates[templateId] = {
                        subject: subjectInput.value,
                        heading: headingInput.value,
                        opening: openingInput.value,
                        prize: prizeInput.value
                    };
                } else {
                    // Handle standard templates
                    const subjectInput = document.getElementById(templateId + '-subject');
                    const bodyInput = document.getElementById(templateId + '-body');

                    if (!subjectInput || !bodyInput) {
                        throw new Error('Template inputs not found');
                    }

                    const subject = subjectInput.value;
                    const body = bodyInput.value;

                    // Save subject
                    const subjectResponse = await fetch('http://localhost:3000/api/update-email-template', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            templateType,
                            variation: variation.toString(),
                            field: 'subject',
                            value: subject
                        })
                    });

                    if (!subjectResponse.ok) {
                        const error = await subjectResponse.json();
                        throw new Error(error.error || 'Failed to save subject');
                    }

                    // Save body
                    const bodyResponse = await fetch('http://localhost:3000/api/update-email-template', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            templateType,
                            variation: variation.toString(),
                            field: 'body',
                            value: body
                        })
                    });

                    if (!bodyResponse.ok) {
                        const error = await bodyResponse.json();
                        throw new Error(error.error || 'Failed to save body');
                    }

                    // Update original template
                    originalTemplates[templateId] = { subject, body };
                }

                showAlert('‚úì Template saved and deployed successfully!', 'success');

            } catch (error) {
                showAlert('‚úó Save failed: ' + error.message, 'error');
                console.error('Save error:', error);
            } finally {
                event.target.disabled = false;
                event.target.innerHTML = 'üíæ Save & Deploy';
            }
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type} show`;

            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // Main section navigation
        function showMainSection(section) {
            // Hide email subnav
            document.getElementById('email-subnav').style.display = 'none';

            // Update main nav buttons
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Hide all sections
            document.querySelectorAll('.email-card').forEach(card => {
                card.classList.remove('active');
            });

            // Show appropriate section
            if (section === 'email') {
                // Show email subnav and email overview
                document.getElementById('email-subnav').style.display = 'flex';
                const emailOverview = document.getElementById('email-overview');
                if (emailOverview) {
                    emailOverview.classList.add('active');
                }
            } else {
                // Show the section directly
                const sectionElement = document.getElementById(section);
                if (sectionElement) {
                    sectionElement.classList.add('active');
                }
            }
        }

        // Refresh analytics data
        async function refreshAnalytics() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Loading...';

            try {
                const response = await fetch('/api/get-analytics');
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'Failed to fetch analytics');
                }

                const data = result;

                // Update Email metrics
                document.getElementById('email-sent-count').textContent = data.email.totalSent;
                document.getElementById('email-open-rate').textContent = data.email.openRate + '%';
                document.getElementById('email-click-rate').textContent = data.email.clickRate + '%';
                document.getElementById('email-conversion-rate').textContent = data.email.conversionRate + '%';

                // Update Email template table
                const tbody = document.getElementById('email-template-stats');
                tbody.innerHTML = data.email.templates.map(template => `
                    <tr style="border-bottom: 1px solid #e0e0e0;">
                        <td style="padding: 12px;">${template.template}</td>
                        <td style="padding: 12px; text-align: center;">${template.sent}</td>
                        <td style="padding: 12px; text-align: center;">${template.opened}</td>
                        <td style="padding: 12px; text-align: center;">${template.clicked}</td>
                        <td style="padding: 12px; text-align: center;">${template.openRate}%</td>
                        <td style="padding: 12px; text-align: center;">${template.clickRate}%</td>
                    </tr>
                `).join('');

                // Update WhatsApp metrics
                document.getElementById('whatsapp-sent-count').textContent = data.whatsapp.totalSent;
                document.getElementById('whatsapp-read-rate').textContent = data.whatsapp.readRate + '%';
                document.getElementById('whatsapp-reply-rate').textContent = data.whatsapp.replyRate + '%';

                // Update SMS metrics
                document.getElementById('sms-sent-count').textContent = data.sms.totalSent;
                document.getElementById('sms-delivery-rate').textContent = data.sms.deliveryRate + '%';
                document.getElementById('sms-click-rate').textContent = data.sms.clickRate + '%';

                // Update Funnel metrics
                document.getElementById('funnel-visitors').textContent = data.funnel.totalVisitors;
                document.getElementById('funnel-form-starts').textContent = data.funnel.formStarts;
                document.getElementById('funnel-completions').textContent = data.funnel.completions;
                document.getElementById('funnel-conversion-rate').textContent = data.funnel.conversionRate + '%';

                // Update timestamp
                const lastUpdated = new Date(data.lastUpdated);
                document.getElementById('last-updated').textContent = lastUpdated.toLocaleString();

                showAlert('‚úì Analytics refreshed with live data!', 'success');

            } catch (error) {
                showAlert('‚úó Refresh failed: ' + error.message, 'error');
                console.error('Analytics refresh error:', error);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Refresh Now';
            }
        }

        // Funnel switching
        function switchFunnel() {
            const funnel = document.getElementById('funnel-selector').value;
            const mainEditor = document.getElementById('funnel-main-editor');
            const earlybirdEditor = document.getElementById('funnel-earlybird-editor');

            if (funnel === 'main') {
                mainEditor.style.display = 'grid';
                earlybirdEditor.style.display = 'none';
            } else {
                mainEditor.style.display = 'none';
                earlybirdEditor.style.display = 'grid';
            }
        }

        // Save and push funnel to live
        async function saveAndPushFunnel() {
            const funnel = document.getElementById('funnel-selector').value;
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Pushing Live...';

            try {
                const content = {
                    hero: {
                        headline: document.getElementById(`funnel-${funnel}-hero-headline`).value,
                        subheadline: document.getElementById(`funnel-${funnel}-hero-subheadline`).value,
                        cta: document.getElementById(`funnel-${funnel}-hero-cta`).value
                    },
                    prize: {
                        headline: document.getElementById(`funnel-${funnel}-prize-headline`).value,
                        description: document.getElementById(`funnel-${funnel}-prize-description`).value
                    },
                    referral: {
                        headline: document.getElementById(`funnel-${funnel}-referral-headline`).value,
                        description: document.getElementById(`funnel-${funnel}-referral-description`).value
                    }
                };

                const response = await fetch('http://localhost:3000/api/update-funnel-content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ funnel, content })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to update funnel');
                }

                showAlert(`‚úì ${funnel === 'main' ? 'Main' : 'Early Bird'} funnel pushed live successfully!`, 'success');

            } catch (error) {
                showAlert('‚úó Push failed: ' + error.message, 'error');
                console.error('Push error:', error);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üöÄ Save & Push Live';
            }
        }

        // Sync both funnels
        async function syncFunnels() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Syncing...';

            try {
                // Get content from main funnel
                const mainContent = {
                    hero: {
                        headline: document.getElementById('funnel-main-hero-headline').value,
                        subheadline: document.getElementById('funnel-main-hero-subheadline').value,
                        cta: document.getElementById('funnel-main-hero-cta').value
                    },
                    prize: {
                        headline: document.getElementById('funnel-main-prize-headline').value,
                        description: document.getElementById('funnel-main-prize-description').value
                    },
                    referral: {
                        headline: document.getElementById('funnel-main-referral-headline').value,
                        description: document.getElementById('funnel-main-referral-description').value
                    }
                };

                // Copy to earlybird fields
                document.getElementById('funnel-earlybird-hero-headline').value = mainContent.hero.headline;
                document.getElementById('funnel-earlybird-hero-subheadline').value = mainContent.hero.subheadline;
                document.getElementById('funnel-earlybird-hero-cta').value = mainContent.hero.cta;
                document.getElementById('funnel-earlybird-prize-headline').value = mainContent.prize.headline;
                document.getElementById('funnel-earlybird-prize-description').value = mainContent.prize.description;
                document.getElementById('funnel-earlybird-referral-headline').value = mainContent.referral.headline;
                document.getElementById('funnel-earlybird-referral-description').value = mainContent.referral.description;

                // Save both funnels
                const mainResponse = await fetch('http://localhost:3000/api/update-funnel-content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ funnel: 'main', content: mainContent })
                });

                const earlybirdResponse = await fetch('http://localhost:3000/api/update-funnel-content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ funnel: 'earlybird', content: mainContent })
                });

                if (!mainResponse.ok || !earlybirdResponse.ok) {
                    throw new Error('Failed to sync funnels');
                }

                showAlert('‚úì Both funnels synced and pushed live successfully!', 'success');

            } catch (error) {
                showAlert('‚úó Sync failed: ' + error.message, 'error');
                console.error('Sync error:', error);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Sync Both Funnels';
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üéØ Multi-Channel Communication Manager Loaded');
            console.log('‚úèÔ∏è Edit Email, WhatsApp, SMS & Website content with live preview');

            // Auto-refresh analytics on load
            setTimeout(() => {
                const refreshBtn = document.querySelector('button[onclick="refreshAnalytics()"]');
                if (refreshBtn) {
                    refreshBtn.click();
                }
            }, 1000);
        });
    </script>
</body>
</html>
